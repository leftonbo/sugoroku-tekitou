# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## プロジェクト概要

これはすごろくをテーマにしたインクリメンタル・放置ブラウザゲームです。プレイヤーはサイコロを振って100マスの盤面を進み、クレジットを獲得してアップグレードを購入し、効率化を図ります。

## 開発環境

このプロジェクトは**ブラウザ専用**のゲームで、特別なビルドツールやライブラリのインストールは不要です：

- **開発**: 任意のウェブサーバーまたは直接ファイルを開く
- **実行**: `index.html`をブラウザで開く
- **テスト**: 手動でブラウザ上での動作確認
- **デバッグ**: ブラウザのDevToolsコンソールを使用

## コードアーキテクチャ

### 主要ファイル構成
- `index.html` - メインHTML（Bootstrap 5.3 CDN使用）
- `style.css` - カスタムCSS（レスポンシブデザイン、アニメーション）
- `game.js` - 単一のSugorokuGameクラスですべてのゲームロジックを管理

### ゲームロジック設計

**SugorokuGameクラス**が核となり、以下の責務を持ちます：
- **状態管理**: `gameState`オブジェクトで全ゲーム状態を一元管理
- **永続化**: LocalStorageでの自動保存/読み込み（30秒間隔 + ページ離脱時）
- **ゲームループ**: `requestAnimationFrame`による60fps更新
- **UI管理**: DOM要素の動的更新とイベント処理

### 重要なゲームシステム

**サイコロシステム**:
- 複数種類のサイコロ（2/4/6/8/10/12/20面）を段階的に解放
- 自動化機能（アップグレードで間隔短縮）
- 各サイコロの所持数を増やすアップグレード

**アップグレードシステム**:
- 段階的価格上昇（1.5倍、2倍等の累乗計算）
- `updateDiceUpgradeUI()`で動的なUI生成
- コスト計算は各アップグレード種類で異なるロジック

**プレステージシステム**:
- 100マス到達でプレステージポイント獲得
- 転生でゲーム状態リセット + 統計保存
- `prestigeStats`で実行回数、最高記録等を追跡

### データ構造

`gameState`の主要プロパティ：
- `credits`, `position`, `prestigePoints` - 基本ゲーム状態
- `dice[]` - サイコロ種類の配列（faces, count, unlocked）
- `upgrades` - アップグレードレベル（autoSpeed, diceUpgrades）
- `prestigeStats` - 転生統計（totalRuns, bestSingleRun等）

## 開発方針（最重要）

- **git コミット方針**
  - 指示された作業1単位が終わるごとにコミットする
  - .gitignore に含まれるファイルはコミットしない
  - コミットメッセージの先頭に [gitmoji](https://gitmoji.dev/ja/) を使用すること
    - 頻繁に使用する gitmoji の抜粋
      - 🎉 新規プロジェクト立ち上げ
      - ✨️ 新機能追加
      - 🐛 バグ修正
      - 📝 ドキュメント更新
      - ♻️ リファクタリング
      - 🎨 コードスタイル改善
      - ⚡️ パフォーマンス改善
      - 💥 大幅な仕様変更など破壊的な変更を含む更新
      - 🚀 デプロイ関連
      - 🔧 設定変更
      - 🗃️ 内部データベース更新
      - 💄 UI/UX改善
      - 🚚 ファイル・フォルダ整理
      - 🍱 画像や音声などリソース周りの変更
- **日本語でのコメント**
  - すべてのコード内コメントは日本語で記述
- **レスポンシブ対応**
  - Bootstrap + カスタムCSSでモバイル対応済み
- **ゲームバランス**
  - マス目ごとのクレジット獲得量、アップグレード価格、サイコロ解放コストは現在の数値でバランス調整済み

## 拡張時の設計指針

新機能追加時は以下を考慮：
- `gameState`への新プロパティ追加時は`mergeGameState()`で後方互換性を保つ
- UI要素は`updateUI()`内で状態を反映
- アニメーション効果はCSS＋JavaScriptのクラス操作で実装
- 新しいマス目効果は`applySquareEffect()`を拡張